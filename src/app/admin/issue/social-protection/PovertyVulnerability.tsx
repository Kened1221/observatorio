"use client";

import { Tabs, TabsContent, TabsList, TabsTrigger } from "@/components/ui/tabs";
import { Button } from "@/components/ui/button";
import { Loader2 } from "lucide-react";
import DragDropExcelInput from "@/components/ui/drag-drop-excel-input";

interface PovertyVulnerabilityProps {
  pobrezaVulnerabilidadExcel: { [key: string]: File | null };
  setPobrezaVulnerabilidadExcel: React.Dispatch<
    React.SetStateAction<{ [key: string]: File | null }>
  >;
  uploading: boolean;
  setShowConfirmationModal: React.Dispatch<
    React.SetStateAction<{
      isOpen: boolean;
      category: "pobreza_vulnerabilidad" | "programas_sociales" | null;
      subCategory: string | null;
    }>
  >;
}

export default function PovertyVulnerability({
  pobrezaVulnerabilidadExcel,
  setPobrezaVulnerabilidadExcel,
  uploading,
  setShowConfirmationModal,
}: PovertyVulnerabilityProps) {
  const handleCancel = (subCategory: string) => {
    setPobrezaVulnerabilidadExcel((prev) => ({
      ...prev,
      [subCategory]: null,
    }));
  };

  const handleOpenConfirmationModal = (subCategory: string) => {
    if (pobrezaVulnerabilidadExcel[subCategory]) {
      setShowConfirmationModal({
        isOpen: true,
        category: "pobreza_vulnerabilidad",
        subCategory,
      });
    }
  };

  return (
    <Tabs defaultValue="pobreza">
      <TabsList className="grid w-full grid-cols-2 gap-2 mb-6">
        <TabsTrigger value="pobreza">Pobreza</TabsTrigger>
        <TabsTrigger value="poblacion_vulnerable">Población Vulnerable</TabsTrigger>
      </TabsList>
      <TabsContent value="pobreza">
        <DragDropExcelInput
          file={pobrezaVulnerabilidadExcel.pobreza}
          setFile={(file) =>
            setPobrezaVulnerabilidadExcel((prev) => ({
              ...prev,
              pobreza: file,
            }))
          }
          onFileSelect={(file) =>
            setPobrezaVulnerabilidadExcel((prev) => ({
              ...prev,
              pobreza: file,
            }))
          }
          placeholderText="Arrastra y suelta un archivo Excel (.xlsx, .xls) con datos de pobreza"
        />
        <div className="mt-6 flex gap-4">
          <Button
            className="w-full bg-blue-600 hover:bg-blue-700 text-white"
            onClick={() => handleOpenConfirmationModal("pobreza")}
            disabled={!pobrezaVulnerabilidadExcel.pobreza || uploading}
          >
            {uploading ? (
              <Loader2 className="h-4 w-4 animate-spin mr-2" />
            ) : null}
            {uploading ? "Subiendo..." : "Guardar"}
          </Button>
          <Button
            variant="outline"
            className="w-full border-blue-300 text-blue-600 hover:bg-blue-50"
            onClick={() => handleCancel("pobreza")}
            disabled={!pobrezaVulnerabilidadExcel.pobreza || uploading}
          >
            Cancelar
          </Button>
        </div>
      </TabsContent>
      <TabsContent value="poblacion_vulnerable">
        <Tabs defaultValue="adultos_mayores">
          <TabsList className="grid w-full grid-cols-7 gap-2 mb-6">
            <TabsTrigger value="adultos_mayores">Adultos Mayores</TabsTrigger>
            <TabsTrigger value="mujeres">Mujeres</TabsTrigger>
            <TabsTrigger value="oredis">OREDIS</TabsTrigger>
            <TabsTrigger value="nino_nina">Niño Niña</TabsTrigger>
            <TabsTrigger value="victimas">Víctimas</TabsTrigger>
            <TabsTrigger value="pueblos_indigenas">Pueblos Indígenas</TabsTrigger>
            <TabsTrigger value="juventud">Juventud</TabsTrigger>
          </TabsList>
          <TabsContent value="adultos_mayores">
            <Tabs defaultValue="adultos_mayores_riesgo">
              <TabsList className="grid w-full grid-cols-2 gap-2 mb-6">
                <TabsTrigger value="adultos_mayores_riesgo">
                  Personas en Situación de Riesgo
                </TabsTrigger>
                <TabsTrigger value="adultos_mayores_asociaciones">
                  Asociaciones
                </TabsTrigger>
              </TabsList>
              <TabsContent value="adultos_mayores_riesgo">
                <DragDropExcelInput
                  file={pobrezaVulnerabilidadExcel.adultos_mayores_riesgo}
                  setFile={(file) =>
                    setPobrezaVulnerabilidadExcel((prev) => ({
                      ...prev,
                      adultos_mayores_riesgo: file,
                    }))
                  }
                  onFileSelect={(file) =>
                    setPobrezaVulnerabilidadExcel((prev) => ({
                      ...prev,
                      adultos_mayores_riesgo: file,
                    }))
                  }
                  placeholderText="Arrastra y suelta un archivo Excel (.xlsx, .xls) con datos de adultos mayores en situación de riesgo"
                />
                <div className="mt-6 flex gap-4">
                  <Button
                    className="w-full bg-blue-600 hover:bg-blue-700 text-white"
                    onClick={() =>
                      handleOpenConfirmationModal("adultos_mayores_riesgo")
                    }
                    disabled={
                      !pobrezaVulnerabilidadExcel.adultos_mayores_riesgo ||
                      uploading
                    }
                  >
                    {uploading ? (
                      <Loader2 className="h-4 w-4 animate-spin mr-2" />
                    ) : null}
                    {uploading ? "Subiendo..." : "Guardar"}
                  </Button>
                  <Button
                    variant="outline"
                    className="w-full border-blue-300 text-blue-600 hover:bg-blue-50"
                    onClick={() => handleCancel("adultos_mayores_riesgo")}
                    disabled={
                      !pobrezaVulnerabilidadExcel.adultos_mayores_riesgo ||
                      uploading
                    }
                  >
                    Cancelar
                  </Button>
                </div>
              </TabsContent>
              <TabsContent value="adultos_mayores_asociaciones">
                <DragDropExcelInput
                  file={pobrezaVulnerabilidadExcel.adultos_mayores_asociaciones}
                  setFile={(file) =>
                    setPobrezaVulnerabilidadExcel((prev) => ({
                      ...prev,
                      adultos_mayores_asociaciones: file,
                    }))
                  }
                  onFileSelect={(file) =>
                    setPobrezaVulnerabilidadExcel((prev) => ({
                      ...prev,
                      adultos_mayores_asociaciones: file,
                    }))
                  }
                  placeholderText="Arrastra y suelta un archivo Excel (.xlsx, .xls) con datos de asociaciones de adultos mayores"
                />
                <div className="mt-6 flex gap-4">
                  <Button
                    className="w-full bg-blue-600 hover:bg-blue-700 text-white"
                    onClick={() =>
                      handleOpenConfirmationModal("adultos_mayores_asociaciones")
                    }
                    disabled={
                      !pobrezaVulnerabilidadExcel.adultos_mayores_asociaciones ||
                      uploading
                    }
                  >
                    {uploading ? (
                      <Loader2 className="h-4 w-4 animate-spin mr-2" />
                    ) : null}
                    {uploading ? "Subiendo..." : "Guardar"}
                  </Button>
                  <Button
                    variant="outline"
                    className="w-full border-blue-300 text-blue-600 hover:bg-blue-50"
                    onClick={() => handleCancel("adultos_mayores_asociaciones")}
                    disabled={
                      !pobrezaVulnerabilidadExcel.adultos_mayores_asociaciones ||
                      uploading
                    }
                  >
                    Cancelar
                  </Button>
                </div>
              </TabsContent>
            </Tabs>
          </TabsContent>
          <TabsContent value="mujeres">
            <DragDropExcelInput
              file={pobrezaVulnerabilidadExcel.mujeres}
              setFile={(file) =>
                setPobrezaVulnerabilidadExcel((prev) => ({
                  ...prev,
                  mujeres: file,
                }))
              }
              onFileSelect={(file) =>
                setPobrezaVulnerabilidadExcel((prev) => ({
                  ...prev,
                  mujeres: file,
                }))
              }
              placeholderText="Arrastra y suelta un archivo Excel (.xlsx, .xls) con datos de mujeres vulnerables"
            />
            <div className="mt-6 flex gap-4">
              <Button
                className="w-full bg-blue-600 hover:bg-blue-700 text-white"
                onClick={() => handleOpenConfirmationModal("mujeres")}
                disabled={!pobrezaVulnerabilidadExcel.mujeres || uploading}
              >
                {uploading ? (
                  <Loader2 className="h-4 w-4 animate-spin mr-2" />
                ) : null}
                {uploading ? "Subiendo..." : "Guardar"}
              </Button>
              <Button
                variant="outline"
                className="w-full border-blue-300 text-blue-600 hover:bg-blue-50"
                onClick={() => handleCancel("mujeres")}
                disabled={!pobrezaVulnerabilidadExcel.mujeres || uploading}
              >
                Cancelar
              </Button>
            </div>
          </TabsContent>
          <TabsContent value="oredis">
            <DragDropExcelInput
              file={pobrezaVulnerabilidadExcel.oredis}
              setFile={(file) =>
                setPobrezaVulnerabilidadExcel((prev) => ({
                  ...prev,
                  oredis: file,
                }))
              }
              onFileSelect={(file) =>
                setPobrezaVulnerabilidadExcel((prev) => ({
                  ...prev,
                  oredis: file,
                }))
              }
              placeholderText="Arrastra y suelta un archivo Excel (.xlsx, .xls) con datos de OREDIS"
            />
            <div className="mt-6 flex gap-4">
              <Button
                className="w-full bg-blue-600 hover:bg-blue-700 text-white"
                onClick={() => handleOpenConfirmationModal("oredis")}
                disabled={!pobrezaVulnerabilidadExcel.oredis || uploading}
              >
                {uploading ? (
                  <Loader2 className="h-4 w-4 animate-spin mr-2" />
                ) : null}
                {uploading ? "Subiendo..." : "Guardar"}
              </Button>
              <Button
                variant="outline"
                className="w-full border-blue-300 text-blue-600 hover:bg-blue-50"
                onClick={() => handleCancel("oredis")}
                disabled={!pobrezaVulnerabilidadExcel.oredis || uploading}
              >
                Cancelar
              </Button>
            </div>
          </TabsContent>
          <TabsContent value="nino_nina">
            <DragDropExcelInput
              file={pobrezaVulnerabilidadExcel.nino_nina}
              setFile={(file) =>
                setPobrezaVulnerabilidadExcel((prev) => ({
                  ...prev,
                  nino_nina: file,
                }))
              }
              onFileSelect={(file) =>
                setPobrezaVulnerabilidadExcel((prev) => ({
                  ...prev,
                  nino_nina: file,
                }))
              }
              placeholderText="Arrastra y suelta un archivo Excel (.xlsx, .xls) con datos de niños y niñas vulnerables"
            />
            <div className="mt-6 flex gap-4">
              <Button
                className="w-full bg-blue-600 hover:bg-blue-700 text-white"
                onClick={() => handleOpenConfirmationModal("nino_nina")}
                disabled={!pobrezaVulnerabilidadExcel.nino_nina || uploading}
              >
                {uploading ? (
                  <Loader2 className="h-4 w-4 animate-spin mr-2" />
                ) : null}
                {uploading ? "Subiendo..." : "Guardar"}
              </Button>
              <Button
                variant="outline"
                className="w-full border-blue-300 text-blue-600 hover:bg-blue-50"
                onClick={() => handleCancel("nino_nina")}
                disabled={!pobrezaVulnerabilidadExcel.nino_nina || uploading}
              >
                Cancelar
              </Button>
            </div>
          </TabsContent>
          <TabsContent value="victimas">
            <DragDropExcelInput
              file={pobrezaVulnerabilidadExcel.victimas}
              setFile={(file) =>
                setPobrezaVulnerabilidadExcel((prev) => ({
                  ...prev,
                  victimas: file,
                }))
              }
              onFileSelect={(file) =>
                setPobrezaVulnerabilidadExcel((prev) => ({
                  ...prev,
                  victimas: file,
                }))
              }
              placeholderText="Arrastra y suelta un archivo Excel (.xlsx, .xls) con datos de víctimas"
            />
            <div className="mt-6 flex gap-4">
              <Button
                className="w-full bg-blue-600 hover:bg-blue-700 text-white"
                onClick={() => handleOpenConfirmationModal("victimas")}
                disabled={!pobrezaVulnerabilidadExcel.victimas || uploading}
              >
                {uploading ? (
                  <Loader2 className="h-4 w-4 animate-spin mr-2" />
                ) : null}
                {uploading ? "Subiendo..." : "Guardar"}
              </Button>
              <Button
                variant="outline"
                className="w-full border-blue-300 text-blue-600 hover:bg-blue-50"
                onClick={() => handleCancel("victimas")}
                disabled={!pobrezaVulnerabilidadExcel.victimas || uploading}
              >
                Cancelar
              </Button>
            </div>
          </TabsContent>
          <TabsContent value="pueblos_indigenas">
            <DragDropExcelInput
              file={pobrezaVulnerabilidadExcel.pueblos_indigenas}
              setFile={(file) =>
                setPobrezaVulnerabilidadExcel((prev) => ({
                  ...prev,
                  pueblos_indigenas: file,
                }))
              }
              onFileSelect={(file) =>
                setPobrezaVulnerabilidadExcel((prev) => ({
                  ...prev,
                  pueblos_indigenas: file,
                }))
              }
              placeholderText="Arrastra y suelta un archivo Excel (.xlsx, .xls) con datos de pueblos indígenas"
            />
            <div className="mt-6 flex gap-4">
              <Button
                className="w-full bg-blue-600 hover:bg-blue-700 text-white"
                onClick={() => handleOpenConfirmationModal("pueblos_indigenas")}
                disabled={!pobrezaVulnerabilidadExcel.pueblos_indigenas || uploading}
              >
                {uploading ? (
                  <Loader2 className="h-4 w-4 animate-spin mr-2" />
                ) : null}
                {uploading ? "Subiendo..." : "Guardar"}
              </Button>
              <Button
                variant="outline"
                className="w-full border-blue-300 text-blue-600 hover:bg-blue-50"
                onClick={() => handleCancel("pueblos_indigenas")}
                disabled={!pobrezaVulnerabilidadExcel.pueblos_indigenas || uploading}
              >
                Cancelar
              </Button>
            </div>
          </TabsContent>
          <TabsContent value="juventud">
            <Tabs defaultValue="organizaciones_juveniles">
              <TabsList className="grid w-full grid-cols-2 gap-2 mb-6">
                <TabsTrigger value="organizaciones_juveniles">
                  Organizaciones Juveniles
                </TabsTrigger>
                <TabsTrigger value="consejos_juveniles">
                  Consejos Juveniles
                </TabsTrigger>
              </TabsList>
              <TabsContent value="organizaciones_juveniles">
                <DragDropExcelInput
                  file={pobrezaVulnerabilidadExcel.organizaciones_juveniles}
                  setFile={(file) =>
                    setPobrezaVulnerabilidadExcel((prev) => ({
                      ...prev,
                      organizaciones_juveniles: file,
                    }))
                  }
                  onFileSelect={(file) =>
                    setPobrezaVulnerabilidadExcel((prev) => ({
                      ...prev,
                      organizaciones_juveniles: file,
                    }))
                  }
                  placeholderText="Arrastra y suelta un archivo Excel (.xlsx, .xls) con datos de organizaciones juveniles conformadas"
                />
                <div className="mt-6 flex gap-4">
                  <Button
                    className="w-full bg-blue-600 hover:bg-blue-700 text-white"
                    onClick={() =>
                      handleOpenConfirmationModal("organizaciones_juveniles")
                    }
                    disabled={
                      !pobrezaVulnerabilidadExcel.organizaciones_juveniles ||
                      uploading
                    }
                  >
                    {uploading ? (
                      <Loader2 className="h-4 w-4 animate-spin mr-2" />
                    ) : null}
                    {uploading ? "Subiendo..." : "Guardar"}
                  </Button>
                  <Button
                    variant="outline"
                    className="w-full border-blue-300 text-blue-600 hover:bg-blue-50"
                    onClick={() => handleCancel("organizaciones_juveniles")}
                    disabled={
                      !pobrezaVulnerabilidadExcel.organizaciones_juveniles ||
                      uploading
                    }
                  >
                    Cancelar
                  </Button>
                </div>
              </TabsContent>
              <TabsContent value="consejos_juveniles">
                <DragDropExcelInput
                  file={pobrezaVulnerabilidadExcel.consejos_juveniles}
                  setFile={(file) =>
                    setPobrezaVulnerabilidadExcel((prev) => ({
                      ...prev,
                      consejos_juveniles: file,
                    }))
                  }
                  onFileSelect={(file) =>
                    setPobrezaVulnerabilidadExcel((prev) => ({
                      ...prev,
                      consejos_juveniles: file,
                    }))
                  }
                  placeholderText="Arrastra y suelta un archivo Excel (.xlsx, .xls) con datos de consejos juveniles"
                />
                <div className="mt-6 flex gap-4">
                  <Button
                    className="w-full bg-blue-600 hover:bg-blue-700 text-white"
                    onClick={() =>
                      handleOpenConfirmationModal("consejos_juveniles")
                    }
                    disabled={
                      !pobrezaVulnerabilidadExcel.consejos_juveniles || uploading
                    }
                  >
                    {uploading ? (
                      <Loader2 className="h-4 w-4 animate-spin mr-2" />
                    ) : null}
                    {uploading ? "Subiendo..." : "Guardar"}
                  </Button>
                  <Button
                    variant="outline"
                    className="w-full border-blue-300 text-blue-600 hover:bg-blue-50"
                    onClick={() => handleCancel("consejos_juveniles")}
                    disabled={
                      !pobrezaVulnerabilidadExcel.consejos_juveniles || uploading
                    }
                  >
                    Cancelar
                  </Button>
                </div>
              </TabsContent>
            </Tabs>
          </TabsContent>
        </Tabs>
      </TabsContent>
    </Tabs>
  );
}